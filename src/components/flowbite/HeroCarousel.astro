---
/**
 * Flowbite Hero Carousel Component
 *
 * A hero section with an integrated carousel/slider for showcasing
 * multiple images or content slides.
 *
 * This component uses Flowbite's TypeScript API for programmatic control,
 * which provides better reliability than data attributes and enables
 * features like event callbacks.
 *
 * @see https://flowbite.com/docs/components/carousel/#javascript-behaviour
 * @see https://flowbite.com/blocks/marketing/hero/
 */

export interface Slide {
  image: string;
  alt: string;
}

interface Props {
  headline?: string;
  highlightedText?: string;
  description?: string;
  primaryCta?: {
    label: string;
    href: string;
  };
  secondaryCta?: {
    label: string;
    href: string;
  };
  slides?: Slide[];
  /** Auto-slide interval in milliseconds. Set to 0 to disable. */
  interval?: number;
}

const {
  headline = "Welcome to My Portfolio",
  highlightedText = "Creative Developer",
  description = "I build beautiful, functional websites and applications that help businesses grow and succeed in the digital world.",
  primaryCta = { label: "View My Work", href: "#projects" },
  secondaryCta = { label: "Get In Touch", href: "#contact" },
  slides = [
    { image: "https://flowbite.s3.amazonaws.com/blocks/marketing-ui/hero/phone-mockup.png", alt: "Slide 1" },
    { image: "https://flowbite.s3.amazonaws.com/blocks/marketing-ui/hero/phone-mockup.png", alt: "Slide 2" },
    { image: "https://flowbite.s3.amazonaws.com/blocks/marketing-ui/hero/phone-mockup.png", alt: "Slide 3" },
  ],
  interval = 3000,
} = Astro.props;

// Generate a unique ID for this carousel instance
const carouselId = `hero-carousel-${Math.random().toString(36).slice(2, 9)}`;
---

<section class="bg-white dark:bg-gray-900">
  <div class="mx-auto grid max-w-screen-xl px-4 py-8 lg:grid-cols-12 lg:gap-8 lg:py-16 xl:gap-0">
    <div class="mr-auto place-self-center lg:col-span-7">
      <h1
        class="mb-4 max-w-2xl text-4xl font-extrabold leading-none tracking-tight md:text-5xl xl:text-6xl dark:text-white"
      >
        {headline}
        {
          highlightedText && (
            <>
              <br />
              <span class="text-blue-600 dark:text-blue-500">{highlightedText}</span>
            </>
          )
        }
      </h1>
      <p
        class="mb-6 max-w-2xl font-light text-gray-500 md:text-lg lg:mb-8 lg:text-xl dark:text-gray-400"
      >
        {description}
      </p>
      <div class="flex flex-wrap gap-3">
        {
          primaryCta && (
            <a
              href={primaryCta.href}
              class="inline-flex items-center justify-center rounded-lg bg-blue-700 px-5 py-3 text-center text-base font-medium text-white hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 dark:focus:ring-blue-900"
            >
              {primaryCta.label}
              <svg
                class="-mr-1 ml-2 h-5 w-5"
                fill="currentColor"
                viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </a>
          )
        }
        {
          secondaryCta && (
            <a
              href={secondaryCta.href}
              class="inline-flex items-center justify-center rounded-lg border border-gray-300 px-5 py-3 text-center text-base font-medium text-gray-900 hover:bg-gray-100 focus:ring-4 focus:ring-gray-100 dark:border-gray-700 dark:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-800"
            >
              {secondaryCta.label}
            </a>
          )
        }
      </div>
    </div>

    <!-- Carousel Container -->
    <div class="hidden lg:col-span-5 lg:mt-0 lg:flex">
      <div
        id={carouselId}
        class="hero-carousel relative w-full"
        data-carousel-interval={interval}
      >
        <!-- Carousel wrapper -->
        <div class="carousel-wrapper relative h-80 overflow-hidden rounded-lg md:h-96">
          {
            slides.map((slide, index) => (
              <div
                class="carousel-item absolute inset-0 transition-transform duration-700 ease-in-out"
                data-carousel-index={index}
              >
                <img
                  src={slide.image}
                  class="absolute left-1/2 top-1/2 block w-full -translate-x-1/2 -translate-y-1/2"
                  alt={slide.alt}
                />
              </div>
            ))
          }
        </div>

        <!-- Slider indicators -->
        <div class="absolute bottom-5 left-1/2 z-30 flex -translate-x-1/2 space-x-3 rtl:space-x-reverse">
          {
            slides.map((_, index) => (
              <button
                type="button"
                class="carousel-indicator h-3 w-3 rounded-full bg-white/50 hover:bg-white"
                data-carousel-slide-to={index}
                aria-label={`Slide ${index + 1}`}
              />
            ))
          }
        </div>

        <!-- Slider controls -->
        <button
          type="button"
          class="carousel-prev group absolute start-0 top-0 z-30 flex h-full cursor-pointer items-center justify-center px-4 focus:outline-none"
          aria-label="Previous slide"
        >
          <span
            class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/30 group-hover:bg-white/50 group-focus:outline-none group-focus:ring-4 group-focus:ring-white dark:bg-gray-800/30 dark:group-hover:bg-gray-800/60 dark:group-focus:ring-gray-800/70"
          >
            <svg
              class="h-4 w-4 text-white rtl:rotate-180 dark:text-gray-800"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 6 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 1 1 5l4 4"></path>
            </svg>
          </span>
        </button>
        <button
          type="button"
          class="carousel-next group absolute end-0 top-0 z-30 flex h-full cursor-pointer items-center justify-center px-4 focus:outline-none"
          aria-label="Next slide"
        >
          <span
            class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white/30 group-hover:bg-white/50 group-focus:outline-none group-focus:ring-4 group-focus:ring-white dark:bg-gray-800/30 dark:group-hover:bg-gray-800/60 dark:group-focus:ring-gray-800/70"
          >
            <svg
              class="h-4 w-4 text-white rtl:rotate-180 dark:text-gray-800"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 6 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="m1 9 4-4-4-4"></path>
            </svg>
          </span>
        </button>
      </div>
    </div>
  </div>
</section>

<script>
  import { Carousel } from "flowbite";
  import type { CarouselItem, CarouselOptions } from "flowbite";

  // Initialize all hero carousels on the page
  function initCarousels() {
    const carouselElements = document.querySelectorAll<HTMLElement>(".hero-carousel");

    carouselElements.forEach((carouselEl) => {
      // Skip if already initialized
      if (carouselEl.dataset.initialized === "true") return;

      const wrapper = carouselEl.querySelector(".carousel-wrapper");
      const slideElements = carouselEl.querySelectorAll<HTMLElement>(".carousel-item");
      const indicators = carouselEl.querySelectorAll<HTMLElement>(".carousel-indicator");
      const prevButton = carouselEl.querySelector<HTMLElement>(".carousel-prev");
      const nextButton = carouselEl.querySelector<HTMLElement>(".carousel-next");

      if (!wrapper || slideElements.length === 0) return;

      // Build the items array for Flowbite's Carousel API
      const items: CarouselItem[] = Array.from(slideElements).map((el, index) => ({
        position: index,
        el: el,
      }));

      // Get interval from data attribute
      const interval = parseInt(carouselEl.dataset.carouselInterval || "3000", 10);

      // Configure carousel options
      const options: CarouselOptions = {
        defaultPosition: 0,
        interval: interval > 0 ? interval : undefined,
        indicators: {
          activeClasses: "bg-white",
          inactiveClasses: "bg-white/50 hover:bg-white",
          items: Array.from(indicators).map((el, index) => ({
            position: index,
            el: el,
          })),
        },
        onNext: () => {
          // Optional: Add analytics or custom behavior on next
        },
        onPrev: () => {
          // Optional: Add analytics or custom behavior on prev
        },
        onChange: () => {
          // Optional: Sync with other components or update state
        },
      };

      // Create the carousel instance
      const carousel = new Carousel(carouselEl, items, options);

      // Wire up prev/next buttons
      prevButton?.addEventListener("click", () => carousel.prev());
      nextButton?.addEventListener("click", () => carousel.next());

      // Wire up indicator buttons
      indicators.forEach((indicator, index) => {
        indicator.addEventListener("click", () => carousel.slideTo(index));
      });

      // Mark as initialized to prevent duplicate initialization
      carouselEl.dataset.initialized = "true";

      // Start cycling if interval is set
      if (interval > 0) {
        carousel.cycle();
      }
    });
  }

  // Initialize on page load
  initCarousels();

  // Re-initialize after Astro page transitions (View Transitions API)
  document.addEventListener("astro:page-load", initCarousels);
</script>

<style>
  /* Initial state: all slides hidden except active */
  .carousel-item {
    opacity: 0;
    z-index: 0;
  }

  .carousel-item[data-active="true"],
  .carousel-item.active {
    opacity: 1;
    z-index: 20;
  }
</style>
